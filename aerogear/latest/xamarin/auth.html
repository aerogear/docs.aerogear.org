<!DOCTYPE html>
<html lang="en">
  <head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/zepto/1.2.0/zepto.min.js"></script>
<script>
function addBlockSwitches() {
	$('.primary').each(function() {
		primary = $(this);
		createSwitchItem(primary, createBlockSwitch(primary)).item.addClass("selected");
		primary.children('.title').remove();
	});
	$('.secondary').each(function(idx, node) {
		secondary = $(node);
		primary = findPrimary(secondary);
		switchItem = createSwitchItem(secondary, primary.children('.switch'));
		switchItem.content.addClass('hidden');
		findPrimary(secondary).append(switchItem.content);
		secondary.remove();
	});
}

function createBlockSwitch(primary) {
	blockSwitch = $('<div class="switch"></div>');
	primary.prepend(blockSwitch);
	return blockSwitch;
}

function findPrimary(secondary) {
	candidate = secondary.prev();
	while (!candidate.is('.primary')) {
		candidate = candidate.prev();
	}
	return candidate;
}

function createSwitchItem(block, blockSwitch) {
	blockName = block.children('.title').text();
	content = block.children('.content').first().append(block.next('.colist'));
	item = $('<div class="switch--item">' + blockName + '</div>');
	item.on('click', '', content, function(e) {
		$(this).addClass('selected');
		$(this).siblings().removeClass('selected');
		e.data.siblings('.content').addClass('hidden');
		e.data.removeClass('hidden');
	});
	blockSwitch.append(item);
	return {'item': item, 'content': content};
}

$(addBlockSwitches);    
</script>


    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AeroGear Xamarin Auth SDK :: AeroGear Mobile Services</title>
    <link rel="canonical" href="https://www.aerogear.org/aerogear/latest/xamarin/auth.html">
    <meta name="generator" content="Antora 1.0.0">
    <link rel="stylesheet" href="../../../_/css/site.css">
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.aerogear.org">AeroGear Mobile Services</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">

    </div>
  </nav>
</header>
<div class="main-wrapper">
<div class="navigation-container" data-component="aerogear" data-version="latest">
  <aside class="navigation" role="navigation">
    <div class="panels">
<div class="navigation-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">AeroGear Docs</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../index.html">Getting Started</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installing-mobile-services.html">Installing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../mobile_terminology.html">Terminology</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started-with-openshift.html">Getting Started with OpenShift</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../workflow.html">Mobile Apps &amp; Services Workflow</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../con_services.html">Introducing Mobile Services</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../provisioning-services.html">Provisioning</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integrating-services.html">Binding Services</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../apps.html">Integrating Mobile Apps</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../registering-a-mobile-app.html">Registering an App</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../binding-mobile-app-record-to-mobile-services.html">Binding an App to a Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuring-dev-env.html">Configuring a Dev Environment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">Using Mobile Services</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../push/index.html">Push Notifications</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../push/provisioning.html">Provisioning</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../push/binding.html">Binding</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../push/configuring-dev-env-push.html">Configuring a Dev Environment</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../push/coding.html">Adding Code</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../push/proc_sending-a-push-notification.html">Sending a Push Notification</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-toggle"></button>
    <span class="nav-text">More&#8230;&#8203;</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../push/admin-ui.html">Unified Push admin UI</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../push/handling-push-notifications.html">Handling Push Notifications</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../push/proc_preparing-ups-for-use-with-ios.html">Apple Push Network</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../push/google-setup.html">Firebase Cloud Messaging</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../metrics/index.html">Mobile Metrics</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../metrics/provisioning.html">Provisioning</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../metrics/binding.html">Binding</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../metrics/configuring-dev-env-metrics.html">Configuring a Dev environment</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../metrics/analysing-app-usage.html">Analysing App Usage</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../monitoring-keycloak.html">Monitoring Identity Management</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../keycloak/index.html">Identity Management</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../keycloak/provisioning.html">Provisioning</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../keycloak/binding.html">Binding</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../keycloak/configuring-dev-env-keycloak.html">Configuring a Dev environment</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../keycloak/coding.html">Adding Code</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-toggle"></button>
    <span class="nav-text">More&#8230;&#8203;</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../keycloak/keycloak-setup.html">Keycloak Setup</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../keycloak/android-additional-configuration.html">Additional Configuration for Android</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../keycloak/retrieving-current-user.html">Retrieving Current User</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../keycloak/retrieving-custom-user-attributes.html">Retrieving Custom User Attributes</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../keycloak/authenticating.html">Authenticating</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../keycloak/retrieving-users-roles.html">Retrieving Users Roles</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../keycloak/logging-out.html">Logging Out</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../digger/index.html">Mobile CI/CD</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../digger/provisioning.html">Provisioning</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../digger/binding.html">Binding</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../digger/configuring-dev-env-digger.html">Configuring a Dev environment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../custom/index.html">Runtime Connector</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../custom/provisioning.html">Provisioning</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../custom/binding.html">Binding</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../custom/configuring-dev-env-custom.html">Configuring a Dev environment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../security/index.html">Device Security</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../security/provisioning.html">Provisioning</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../security/binding.html">Binding</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../security/configuring-dev-env-security.html">Configuring a Dev environment</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#">security/proc_performing-device-checks.adoc</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../security/proc_pinning-certificates.html">Certificate Pinning</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../security/proc_self-signed-certs.html">Self Signed Certificates</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#">security/proc_adding_secure_storage.adoc</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../using-the-showcase-apps.html">Using the Showcase Apps</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../testcard.html">Mobile Metrics for the Showcase App</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../testcard.html">Identity Management for the Showcase App</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../testcard.html">Mobile CI/CD for the Showcase App</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../testcard.html">Runtime Connector for the Showcase App</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../testcard.html">Push Notifications for the Showcase App</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../local_development.html">Setting up AeroGear Mobile Services locally</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../ref_api.html">API Reference</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../mobile-cli.html">Mobile CLI</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="navigation-explore" data-panel="explore">
  <div class="context">
    <span class="title">AeroGear Docs</span>
    <span class="version">latest</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">AeroGear Docs</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">latest</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
  <main class="main" role="main">
<div class="toolbar" role="navigation">
  <button class="navigation-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="crumbs" role="navigation" aria-label="breadcrumbs">
</nav>
  <div class="edit-this-page"><a href="https://github.com/aerogear/mobile-docs/edit/master/modules/ROOT/pages/xamarin/auth.adoc"></a></div>
</div>
<article class="doc">
<h1>AeroGear Xamarin Auth SDK</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Mobile authentication SDK based on <a href="http://www.keycloak.org/">Keycloak</a> using <a href="http://openid.net/connect/">OpenID Connect</a>.</p>
</div>
<div class="paragraph">
<p>Provides authentication features like access control and two factor authentication through Keycloak.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="usage"><a class="anchor" href="#usage"></a>Usage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To use the Auth SDK you&#8217;ll first need to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Have a Keycloak instance. See <a href="#setting-up-keycloak">Setting up Keycloak</a>.</p>
</li>
<li>
<p>Import the Core module. See <a href="./core.html">the Core documentation</a>.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="setting-up-keycloak"><a class="anchor" href="#setting-up-keycloak"></a>Setting up Keycloak</h3>
<div class="sect3">
<h4 id="using-openshift"><a class="anchor" href="#using-openshift"></a>Using OpenShift</h4>
<div class="ulist">
<ul>
<li>
<p>If you do not have mobile services enabled in your openshift cluster follow this <a href="https://github.com/aerogear/mobile-core/blob/master/docs/walkthroughs/local-setup.adoc">Local Setup</a> guide.</p>
</li>
<li>
<p>Navigate to your Openshift cluster and in the Service Catalog search for the Keycloak service.</p>
</li>
<li>
<p>Click on the Keycloak service and you will be prompted to fill in details about your app.  For now you can leave these as they are.  Navigate through the setup and click Create.
This will provision the Keycloak service in the project you specified and create a public Client to be used with an app along with a bearer-only client.
See <a href="http://www.keycloak.org/docs/latest/server_admin/index.html#oidc-clients">Keycloak OIDC client documentation</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After provisioning, the Keycloak service will be available at the exposed Route. You can view this route inside your project or use the below command to get the route:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oc get route keycloak --template "http://{{.spec.host}} "</pre>
</div>
</div>
<div class="paragraph">
<p>The route should look like <code><a href="https://keycloak-myproject.192.168.37.1.nip.io/auth/" class="bare">https://keycloak-myproject.192.168.37.1.nip.io/auth/</a></code>.<br></p>
</div>
</div>
<div class="sect3">
<h4 id="standalone"><a class="anchor" href="#standalone"></a>Standalone</h4>
<div class="paragraph">
<p>To setup standalone Keycloak follow Keycloak&#8217;s guide <a href="https://github.com/keycloak/keycloak/blob/master/README.md">here</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuration-file"><a class="anchor" href="#configuration-file"></a>Configuration file</h3>
<div class="paragraph">
<p>A <code>mobile-services.json</code> file must exist in Resources folder of the apps directory. It should specify configuration
for Keycloak. This configuration can be generated by the <a href="https://github.com/aerogear/mobile-cli">AeroGear Mobile CLI</a>.</p>
</div>
<div class="paragraph">
<p>For an example of Keycloak configuration see <a href="../../example/src/main/assets/mobile-services.json">example apps mobile-services.json</a>.</p>
</div>
<div class="paragraph">
<p>The Auth SDK will use this configuration to communicate with Keycloak.</p>
</div>
</div>
<div class="sect2">
<h3 id="initializing-the-sdk"><a class="anchor" href="#initializing-the-sdk"></a>Initializing the SDK</h3>
<div class="paragraph">
<p>Before using the Auth SDK it must first be initialized and configured. During
configuration an <code>AuthenticationConfig</code> must be provided to the SDK.</p>
</div>
<div class="paragraph">
<p>An example of initializing and configuring the
SDK is:</p>
</div>
<div class="sect3">
<h4 id="android"><a class="anchor" href="#android"></a>Android</h4>
<div class="listingblock">
<div class="title">MainActivity.cs</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#">var app = new App();
MobileCoreAndroid.Init(app.GetType().Assembly,ApplicationContext);
var authService = AuthService.InitializeService();
var authConfig = AuthenticationConfig.Builder.RedirectUri("org.aerogear.mobile.example:/callback").Build();
authService.Configure(authConfig);</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For Android an <a href="https://developer.android.com/guide/topics/manifest/intent-filter-element">intent-filter</a>
should be configured with the callback URL specified in <code>AuthenticateOptions</code> in
the apps <code>AndroidManifest.xml</code>. See <a href="https://github.com/aerogear/aerogear-xamarin-sdk/blob/master/Example/Example.Android/Properties/AndroidManifest.xml">the example app</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="ios"><a class="anchor" href="#ios"></a>iOS</h4>
<div class="listingblock">
<div class="title">AppDelegate.cs</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#">var app = new App();
MobileCore core = MobileCoreIOS.Init(app.GetType().Assembly);
var authService = AuthService.InitializeService();
var authConfig = AuthenticationConfig.Builder.RedirectUri("org.aerogear.mobile.example:/callback").Build();
authService.Configure(authConfig);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="retrieving-the-current-user"><a class="anchor" href="#retrieving-the-current-user"></a>Retrieving the current user</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#">// auth service is already initialised
var user = MobileCore.Instance.GetInstance&lt;IAuthService&gt;().CurrentUser();

var username = user.Username;
var email = user.Email;
var accessToken = user.AccessToken;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="authenticating"><a class="anchor" href="#authenticating"></a>Authenticating</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#">IAuthService service = MobileCore.Instance.GetInstance&lt;IAuthService&gt;();
var authOptions = DependencyService.Get&lt;IAuthenticateOptionsProvider&gt;().GetOptions();
service.Authenticate(authOptions).ContinueWith(result =&gt;
{
    // load some view
});</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="retrieving-a-user-s-roles"><a class="anchor" href="#retrieving-a-user-s-roles"></a>Retrieving a User&#8217;s Roles</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#">// listing all Roles for a previously initialised authService

var user = MobileCore.Instance.GetInstance&lt;IAuthService&gt;().CurrentUser();
var roleItems = new List&lt;string&gt; { };
foreach(var role in user.getRoles())
{
    roleItems.Add(role.ToString());
}

// do something with roleItems;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#">// checking if the current user has a specific realm role

var user = MobileCore.Instance.GetInstance&lt;IAuthService&gt;().CurrentUser();
bool isAdmin = user.HasRealmRole("user_admin");
if (isAdmin) {
    // Show some component
}

// checking if the user has a role from a specific resource named my_resource.
bool isModerator = user.HasResourceRole("my_resource", "user_moderator");
if (isModerator) {
    // Enable some button
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="logging-out"><a class="anchor" href="#logging-out"></a>Logging Out</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#">// auth service already initialised

var authService = MobileCore.Instance.GetInstance&lt;IAuthService&gt;();
authService.Logout(authService.CurrentUser()).ContinueWith(result =&gt;
{
    // load some view
});</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To perform backchannel or federated logouts, you must enable the Backchannel Logout option for the federated identity provider. More information is available in the Keycloak documentation under  <a href="http://www.keycloak.org/docs/latest/server_admin/index.html#openid-connect-v1-0-identity-providers">OIDC Identity Providers</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</article>
  </main>
</div>
<footer class="footer">
  <p>This is a preview of the https://docs.aerogear.org website.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<script src="../../../_/js/vendor/highlight.js"></script>
<script>hljs.initHighlighting()</script>
  </body>
</html>
